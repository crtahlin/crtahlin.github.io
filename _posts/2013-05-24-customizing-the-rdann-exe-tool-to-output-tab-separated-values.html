---
layout: post
title: Customizing the rdann.exe tool to output tab separated values
date: 2013-05-24
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
rdann.exe is part of the WFDB toolset that can be used to extract data from physionet.org databases:<br /><a href="http://www.physionet.org/physiotools/wfdb-windows-quick-start.shtml">http://www.physionet.org/physiotools/wfdb-windows-quick-start.shtml</a><br /><br />It outputs its columns separated by spaces and tabs (tab only used in the last column). This was problematic for me while trying to import the output into R. I would want only tabs to separate the columns.<br /><br />Following the instructions on the above mentioned page under the heading "Using Cygwin gcc to compile and link your applications with the WFDB library", I&nbsp;modified&nbsp;the rdann.c source file (copyrighted by George B. Moody) and rebuilt the executable. I only changed the bit where the spaces / tabs as separators were defined. Have tested it for scenarios applicable for me and it seems to work...<br /><br />Since I believe it is LGPLed I dare to attach just the modified bit of code colored yellow (with the disclaimer that it might not work as&nbsp;expected). The original sources can be found <a href="http://www.physionet.org/physiotools/wfdb.tar.gz">here</a>.<br /><br />This is a snippet of lines 250 - 284 in the rdann.c file:<br /><br /><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;">&nbsp; &nbsp; if (vflag) {<span class="Apple-tab-span" style="white-space: pre;"> </span>/* print column headings */</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;">&nbsp; &nbsp; &nbsp; if (eflag)</span><br /><span style="background-color: yellow; font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>(void)printf("Elapsed time\tSample #\t");</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;">&nbsp; &nbsp; &nbsp; else if (xflag)</span><br /><span style="background-color: yellow; font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>(void)printf("Seconds\tMinutes\tHours\t");</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;">&nbsp; &nbsp; &nbsp; else if (strchr(mstimstr((WFDB_Time)(-1)), '/'))</span><br /><span style="background-color: yellow; font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp;(void)printf("Time Date\tSample #\t");</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;">&nbsp; &nbsp; &nbsp; else if (*(mstimstr((WFDB_Time)(-1))) == '[')</span><br /><span style="background-color: yellow; font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp;(void)printf("Time\tSample #\t");</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;">&nbsp; &nbsp; &nbsp; else</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp;(void)printf("Time\tSample #\t");</span><br /><span style="background-color: yellow; font-family: Courier New, Courier, monospace; font-size: xx-small;">&nbsp; &nbsp; &nbsp; (void)printf("Type\tSub\tChan\tNum\tAux\n");</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;">&nbsp; &nbsp; }</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><br /></span><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;">&nbsp; &nbsp; while (getann(0, &amp;annot) == 0 &amp;&amp; (to == 0L || annot.time &lt;= to)) {</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>if ((flag[0] || (isann(annot.anntyp) &amp;&amp; flag[annot.anntyp])) &amp;&amp;</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp;(cflag == 0 || annot.chan == chanmatch) &amp;&amp;</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp;(nflag == 0 || annot.num == nummatch) &amp;&amp;</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp;(sflag == 0 || annot.subtyp == submatch)) {</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp;if (eflag)</span><br /><span style="background-color: yellow; font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>(void)printf("%s\t%7ld\t", mstimstr(annot.time), annot.time);</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp;else if (xflag)</span><br /><span style="background-color: yellow; font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>(void)printf("%9.3lf\t%9.5lf\t%9.7lf\t",</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;">   </span> &nbsp; &nbsp; annot.time/sps, annot.time/spm, annot.time/sph);</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp;else</span><br /><span style="background-color: yellow; font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>(void)printf("%s\t%7ld\t", mstimstr(-annot.time), annot.time);</span><br /><span style="background-color: yellow; font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp;(void)printf("%6s\t%5d\t%5d\t%5d\t", annstr(annot.anntyp), annot.subtyp,</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;">  </span>annot.chan, annot.num);</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp;if (annot.aux != NULL) (void)printf("%s", annot.aux + 1);</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span> &nbsp; &nbsp;(void)printf("\n");</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>}</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>if (ato &amp;&amp; ++anum &gt;= ato) break;</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;"><span class="Apple-tab-span" style="white-space: pre;"> </span>if (bto &amp;&amp; isqrs(annot.anntyp) &amp;&amp; ++bnum &gt;= bto) break;</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;">&nbsp; &nbsp; }</span><br /><span style="font-family: Courier New, Courier, monospace; font-size: xx-small;">&nbsp; &nbsp; exit(0);<span class="Apple-tab-span" style="white-space: pre;"> </span>/*NOTREACHED*/</span><br /><br /><br />P.s.: If compilation fails with some strange errors, check if perhaps gcc compiler from the Rtools&nbsp;package&nbsp;is being used. This compiler does not seem to work. Use the compiler from the Cygwin installation (gcc-3 in my case). E.g. make a symlink named "gcc" to it from the /usr/bin folder. Then the configure script seems to find it before the Rtools one and uses it instead. (Who knows how the Rtools compiler suddenly got precedence...)</div>
<h2>Comments</h2>
<div class='comments'>
</div>
